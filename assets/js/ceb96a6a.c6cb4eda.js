"use strict";(self.webpackChunkreact_navigation_website_next=self.webpackChunkreact_navigation_website_next||[]).push([[28004],{64004:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>g,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var a=t(85893),r=t(11151),i=t(74866),o=t(85162);const s={id:"preventing-going-back",title:"Preventing going back",sidebar_label:"Preventing going back"},c=void 0,l={id:"preventing-going-back",title:"Preventing going back",description:"Sometimes you may want to prevent the user from leaving a screen, for example, if there are unsaved changes, you might want to show a confirmation dialog. You can achieve it by using the beforeRemove event.",source:"@site/versioned_docs/version-7.x/preventing-going-back.md",sourceDirName:".",slug:"/preventing-going-back",permalink:"/docs/7.x/preventing-going-back",draft:!1,unlisted:!1,editUrl:"https://github.com/react-navigation/react-navigation.github.io/edit/main/versioned_docs/version-7.x/preventing-going-back.md",tags:[],version:"7.x",frontMatter:{id:"preventing-going-back",title:"Preventing going back",sidebar_label:"Preventing going back"},sidebar:"docs",previous:{title:"Animating elements between screens",permalink:"/docs/7.x/shared-element-transitions"},next:{title:"Call a function when focused screen changes",permalink:"/docs/7.x/function-after-focusing-screen"}},u={},d=[{value:"Limitations",id:"limitations",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Sometimes you may want to prevent the user from leaving a screen, for example, if there are unsaved changes, you might want to show a confirmation dialog. You can achieve it by using the ",(0,a.jsx)(n.code,{children:"beforeRemove"})," event."]}),"\n",(0,a.jsxs)(n.p,{children:["The event listener receives the ",(0,a.jsx)(n.code,{children:"action"})," that triggered it. You can dispatch this action again after confirmation, or check the action object to determine what to do."]}),"\n",(0,a.jsx)(n.p,{children:"Example:"}),"\n",(0,a.jsxs)(i.Z,{groupId:"config",queryString:"config",children:[(0,a.jsx)(o.Z,{value:"static",label:"Static",default:!0,children:(0,a.jsx)(n.pre,{"data-name":"Prevent going back","data-snack":"true","data-version":"7",children:(0,a.jsx)(n.code,{className:"language-js",metastring:'name="Prevent going back" snack version=7',children:"import * as React from 'react';\nimport { Button, Alert, View, TextInput, StyleSheet } from 'react-native';\nimport {\n  useNavigation,\n  createStaticNavigation,\n} from '@react-navigation/native';\nimport { createStackNavigator } from '@react-navigation/stack';\n\n// codeblock-focus-start\nconst EditTextScreen = () => {\n  const [text, setText] = React.useState('');\n  const navigation = useNavigation();\n\n  const hasUnsavedChanges = Boolean(text);\n\n  React.useEffect(\n    () =>\n      navigation.addListener('beforeRemove', (e) => {\n        const action = e.data.action;\n        if (!hasUnsavedChanges) {\n          return;\n        }\n\n        e.preventDefault();\n\n        Alert.alert(\n          'Discard changes?',\n          'You have unsaved changes. Are you sure to discard them and leave the screen?',\n          [\n            { text: \"Don't leave\", style: 'cancel', onPress: () => {} },\n            {\n              text: 'Discard',\n              style: 'destructive',\n              onPress: () => navigation.dispatch(e.data.action),\n            },\n          ]\n        );\n      }),\n    [hasUnsavedChanges, navigation]\n  );\n\n  return (\n    <View style={styles.content}>\n      <TextInput\n        autoFocus\n        style={styles.input}\n        value={text}\n        placeholder=\"Type something\u2026\"\n        onChangeText={setText}\n      />\n    </View>\n  );\n};\n// codeblock-focus-end\n\nconst HomeScreen = () => {\n  const navigation = useNavigation();\n\n  return (\n    <View style={styles.buttons}>\n      <Button\n        title={'Push EditText'}\n        onPress={() => navigation.push('EditText')}\n        style={styles.button}\n      />\n    </View>\n  );\n};\n\nconst RootStack = createStackNavigator({\n  screens: {\n    Home: HomeScreen,\n    EditText: EditTextScreen,\n  },\n});\n\nconst Navigation = createStaticNavigation(RootStack);\n\nexport default function App() {\n  return <Navigation />;\n}\n\nconst styles = StyleSheet.create({\n  content: {\n    flex: 1,\n    padding: 16,\n  },\n  input: {\n    margin: 8,\n    padding: 10,\n    borderRadius: 3,\n    borderWidth: StyleSheet.hairlineWidth,\n    borderColor: 'rgba(0, 0, 0, 0.08)',\n    backgroundColor: 'white',\n  },\n  buttons: {\n    flex: 1,\n    justifyContent: 'center',\n    padding: 8,\n  },\n  button: {\n    margin: 8,\n  },\n});\n"})})}),(0,a.jsxs)(o.Z,{value:"dynamic",label:"Dynamic",children:[(0,a.jsx)(n.pre,{"data-name":"Prevent going back","data-snack":"true","data-version":"7",children:(0,a.jsx)(n.code,{className:"language-js",metastring:'name="Prevent going back" snack version=7',children:"import * as React from 'react';\nimport { Button, Alert, View, TextInput, StyleSheet } from 'react-native';\nimport { NavigationContainer, useNavigation } from '@react-navigation/native';\nimport { createStackNavigator } from '@react-navigation/stack';\n\n// codeblock-focus-start\nconst EditTextScreen = () => {\n  const navigation = useNavigation();\n  const [text, setText] = React.useState('');\n\n  const hasUnsavedChanges = Boolean(text);\n\n  React.useEffect(\n    () =>\n      navigation.addListener('beforeRemove', (e) => {\n        const action = e.data.action;\n        if (!hasUnsavedChanges) {\n          return;\n        }\n\n        e.preventDefault();\n\n        Alert.alert(\n          'Discard changes?',\n          'You have unsaved changes. Are you sure to discard them and leave the screen?',\n          [\n            { text: \"Don't leave\", style: 'cancel', onPress: () => {} },\n            {\n              text: 'Discard',\n              style: 'destructive',\n              onPress: () => navigation.dispatch(e.data.action),\n            },\n          ]\n        );\n      }),\n    [hasUnsavedChanges, navigation]\n  );\n\n  return (\n    <View style={styles.content}>\n      <TextInput\n        autoFocus\n        style={styles.input}\n        value={text}\n        placeholder=\"Type something\u2026\"\n        onChangeText={setText}\n      />\n    </View>\n  );\n};\n// codeblock-focus-end\n\nconst HomeScreen = () => {\n  const navigation = useNavigation();\n\n  return (\n    <View style={styles.buttons}>\n      <Button\n        title={'Push EditText'}\n        onPress={() => navigation.push('EditText')}\n        style={styles.button}\n      />\n    </View>\n  );\n};\n\nconst Stack = createStackNavigator();\n\nexport default function App() {\n  return (\n    <NavigationContainer>\n      <Stack.Navigator>\n        <Stack.Screen name=\"Home\" component={HomeScreen} />\n        <Stack.Screen name=\"EditText\" component={EditTextScreen} />\n      </Stack.Navigator>\n    </NavigationContainer>\n  );\n}\n\nconst styles = StyleSheet.create({\n  content: {\n    flex: 1,\n    padding: 16,\n  },\n  input: {\n    margin: 8,\n    padding: 10,\n    borderRadius: 3,\n    borderWidth: StyleSheet.hairlineWidth,\n    borderColor: 'rgba(0, 0, 0, 0.08)',\n    backgroundColor: 'white',\n  },\n  buttons: {\n    flex: 1,\n    justifyContent: 'center',\n    padding: 8,\n  },\n  button: {\n    margin: 8,\n  },\n});\n"})}),(0,a.jsx)("div",{style:{display:"flex",margin:"16px 0"},children:(0,a.jsx)("video",{playsInline:!0,autoPlay:!0,muted:!0,loop:!0,style:{maxWidth:"280px"},children:(0,a.jsx)("source",{src:"/assets/behavior/prevent-closing.mp4"})})})]})]}),"\n",(0,a.jsx)(n.p,{children:"Previously, the way to do this was to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Override back button in header"}),"\n",(0,a.jsx)(n.li,{children:"Disable back swipe gesture"}),"\n",(0,a.jsx)(n.li,{children:"Override system back button/gesture on Android"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"However, this approach has many important differences in addition to being less code:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It's not coupled to any specific buttons, going back from custom buttons will trigger it as well"}),"\n",(0,a.jsx)(n.li,{children:"It's not coupled to any specific actions, any action that removes the route from state will trigger it"}),"\n",(0,a.jsx)(n.li,{children:"It works across nested navigators, e.g. if the screen is being removed due to an action in parent navigator"}),"\n",(0,a.jsx)(n.li,{children:"User can still swipe back in the stack navigator, however, the swipe will be cancelled if the event was prevented"}),"\n",(0,a.jsx)(n.li,{children:"It's possible to continue the same action that triggered the event"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsxs)(n.p,{children:["There are couple of limitations to be aware of when using the ",(0,a.jsx)(n.code,{children:"beforeRemove"})," event. The event is ",(0,a.jsx)(n.strong,{children:"only"})," triggered whenever a screen is being removed due to a navigation state change. For example:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The user pressed back button on a screen in a stack."}),"\n",(0,a.jsx)(n.li,{children:"The user performed a swipe back gesture."}),"\n",(0,a.jsxs)(n.li,{children:["Some action such as ",(0,a.jsx)(n.code,{children:"pop"})," or ",(0,a.jsx)(n.code,{children:"reset"})," was dispatched which removes the screen from the state."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["This event is ",(0,a.jsx)(n.strong,{children:"not"})," triggered when a screen is being unfocused but not removed. For example:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The user pushed a new screen on top of the screen with the listener in a stack."}),"\n",(0,a.jsx)(n.li,{children:"The user navigated from one tab/drawer screen to another tab/drawer screen."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The event is also ",(0,a.jsx)(n.strong,{children:"not"})," triggered when the user is exiting the screen due to actions not controlled by the navigation state:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The user closes the app (e.g. by pressing the back button on the home screen, closing the tab in the browser, closing it from app switcher etc.). You can additionally use ",(0,a.jsx)(n.a,{href:"https://reactnative.dev/docs/backhandler",children:(0,a.jsx)(n.code,{children:"hardwareBackPress"})})," event on Android, ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/web/api/window/beforeunload_event",children:(0,a.jsx)(n.code,{children:"beforeunload"})})," event on Web etc. to handle some of these cases."]}),"\n",(0,a.jsx)(n.li,{children:"A screen gets unmounted due to conditional rendering, or due to a parent component being unmounted."}),"\n",(0,a.jsxs)(n.li,{children:["A screen gets unmounted due to usage of ",(0,a.jsx)(n.code,{children:"unmountOnBlur"})," options with ",(0,a.jsx)(n.a,{href:"/docs/7.x/bottom-tab-navigator",children:(0,a.jsx)(n.code,{children:"@react-navigation/bottom-tabs"})}),", ",(0,a.jsx)(n.a,{href:"/docs/7.x/drawer-navigator",children:(0,a.jsx)(n.code,{children:"@react-navigation/drawer"})})," etc."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["In addition to the above scenarios, this feature also doesn't work properly with ",(0,a.jsx)(n.a,{href:"/docs/7.x/native-stack-navigator",children:(0,a.jsx)(n.code,{children:"@react-navigation/native-stack"})}),". To make this work, you need to:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Disable the swipe gesture for the screen (",(0,a.jsx)(n.code,{children:"gestureEnabled: false"}),")."]}),"\n",(0,a.jsxs)(n.li,{children:["Override the native back button in the header with a custom back button (",(0,a.jsx)(n.code,{children:"headerLeft: (props) => <CustomBackButton {...props} />"}),")."]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},85162:(e,n,t)=>{t.d(n,{Z:()=>o});t(67294);var a=t(86010);const r={tabItem:"tabItem_Ymn6"};var i=t(85893);function o(e){let{children:n,hidden:t,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,o),hidden:t,children:n})}},74866:(e,n,t)=>{t.d(n,{Z:()=>j});var a=t(67294),r=t(86010),i=t(12466),o=t(16550),s=t(20469),c=t(91980),l=t(67392),u=t(50012);function d(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:r}}=e;return{value:n,label:t,attributes:a,default:r}}))}(t);return function(e){const n=(0,l.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function g(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function v(e){let{queryString:n=!1,groupId:t}=e;const r=(0,o.k6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,c._X)(i),(0,a.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(r.location.search);n.set(i,e),r.replace({...r.location,search:n.toString()})}),[i,r])]}function p(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,i=h(e),[o,c]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!g({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const r=null!=(n=a.find((e=>e.default)))?n:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[l,d]=v({queryString:t,groupId:r}),[p,m]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,i]=(0,u.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:r}),b=(()=>{const e=null!=l?l:p;return g({value:e,tabValues:i})?e:null})();(0,s.Z)((()=>{b&&c(b)}),[b]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!g({value:e,tabValues:i}))throw new Error("Can't select invalid tab value="+e);c(e),d(e),m(e)}),[d,m,i]),tabValues:i}}var m=t(72389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(85893);function x(e){let{className:n,block:t,selectedValue:a,selectValue:o,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.o5)(),u=e=>{const n=e.currentTarget,t=c.indexOf(n),r=s[t].value;r!==a&&(l(n),o(r))},d=e=>{var n;let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{var a;const n=c.indexOf(e.currentTarget)+1;t=null!=(a=c[n])?a:c[0];break}case"ArrowLeft":{var r;const n=c.indexOf(e.currentTarget)-1;t=null!=(r=c[n])?r:c[c.length-1];break}}null==(n=t)||n.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>c.push(e),onKeyDown:d,onClick:u,...i,className:(0,r.Z)("tabs__item",b.tabItem,null==i?void 0:i.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function y(e){let{lazy:n,children:t,selectedValue:r}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=p(e);return(0,f.jsxs)("div",{className:(0,r.Z)("tabs-container",b.tabList),children:[(0,f.jsx)(x,{...e,...n}),(0,f.jsx)(y,{...e,...n})]})}function j(e){const n=(0,m.Z)();return(0,f.jsx)(w,{...e,children:d(e.children)},String(n))}},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var a=t(67294);const r={},i=a.createContext(r);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);